
		/*
 * Copyright (C) 2007 Trivantis Corporation
 */

	
var finishCalled=false;var autoCommit=false;function MySetValue(A,B){var C=getTitleMgrHandle();if (C) C.setVariable(A,B,0);LMSSetValue(A,B);};function loadPage(){var A=readVariable('TrivantisSCORMTimer',0);saveVariable('TrivantisEPS','F');if(A==0||!LMSIsInitialized()){LMSInitialize();var B=(''+LMSGetValue("cmi.completion_status")).toLowerCase();if ((B=="not attempted")||(B=="unknown")||(B=="incomplete")){var C=(''+LMSGetValue("cmi.mode")).toLowerCase();if (C!="review"&&C!="browse"){MySetValue("cmi.exit","suspend");};MySetValue("cmi.completion_status","incomplete");LMSCommit();};startTimer();return true;}else return false;};function startTimer(){var A=new Date().getTime();saveVariable('TrivantisSCORMTimer',A);};function computeTime(){var A=readVariable('TrivantisSCORMTimer',0);if (A!=0){var B=new Date().getTime();var C=B-A;var D=convertTotalMills(C);}else D="P0H0M0S";MySetValue("cmi.session_time",D);};function doBack(){computeTime();saveVariable('TrivantisEPS','T');var A;A=LMSCommit();finishCalled=true;A=LMSFinish();saveVariable('TrivantisSCORMTimer',0);};function doContinue(A){var B=String(LMSGetValue("cmi.mode"));B=B.toLowerCase();if (B!="review"&&B!="browse") MySetValue("cmi.success_status",A);computeTime();saveVariable('TrivantisEPS','T');var C;C=LMSCommit();finishCalled=true;C=LMSFinish();saveVariable('TrivantisSCORMTimer',0);};function doQuit(A){computeTime();saveVariable('TrivantisEPS','T');if (window.sabaScorm2004){LMSSetValue("cmi.exit","");LMSSetValue('adl.nav.request','exitAll');}else{LMSSetValue('adl.nav.request','exit');};LMSCommit();finishCalled=true;LMSFinish();saveVariable('TrivantisSCORMTimer',0);if (A&&window.myTop) myTop.close();};function unloadPage(A,B){var C=readVariable('TrivantisEPS','F');if (C!='T'){if (window.name.indexOf('Trivantis_')==-1) trivScormQuit(A,B,false);}else if (finishCalled!=true&&autoCommit==true){computeTime();LMSCommit();}};function convertTotalMills(A){var B=0;var C=0;var D=0;var E=0;while (A>=3600000){D+=1;A-=3600000;}while (A>=60000){C+=1;A-=60000;}while (A>=1000){B+=1;A-=1000;}while (D>=24){E+=1;D-=24;};var F='P';if (E>0) F+=E+'D';F+='T'+D+'H'+C+'M'+B+'S';return F;};function putSCORMInteractions(A,B,C,D,E,F,G,H,I,J){var K=parseInt(LMSGetValue('cmi.interactions._count'),10);var L='cmi.interactions.'+K;if (A) LMSSetValue(L+'.id',Encode(A));if (B) LMSSetValue(L+'.objectives.0.id',B);if (C) LMSSetValue(L+'.timestamp',C);if (D) LMSSetValue(L+'.type',D);if (E) LMSSetValue(L+'.correct_responses.0.pattern',E);LMSSetValue(L+'.weighting',F);if (G) LMSSetValue(L+'.learner_response',G);if (H) LMSSetValue(L+'.result',H);if (J) LMSSetValue(L+'.description',J);if (I){var M=I.indexOf(':');var N=parseInt(I.substr(0,M),10);var O=0;while (N>=24){O+=1;N-=24;};I=I.substr(M+1);M=I.indexOf(':');var P=I.substr(0,M);var Q=I.substr(M+1);I='P';if (O) I+=O+'D';I+='T'+N+'H'+P+'M'+Q+'S';LMSSetValue(L+'.latency',I);}};
